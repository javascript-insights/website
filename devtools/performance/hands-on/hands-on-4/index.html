<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JavaScript Insights</title>
  <link rel="stylesheet" href="/styles.css" />
  <link rel="stylesheet" href="./styles.css" />
  <link rel="icon" type="image/png" href="/static/favicon.png" />
  <script src="index.js"></script>
</head>

<body>
  <h1>Performance Hands-On 4 - CPU Profiling</h1>
  <nav class="breadcrumb">
    <a href="../../../../index.html">JavaScript Insights</a>
    <a href="../../../index.html">DevTools</a>
    <a href="../../index.html">Performance</a>
    <a href="../index.html">Hands-On</a>
    <a href="./index.html">CPU</a>
  </nav>
  <div class="navbar">
    <a href="../index.html">Back</a>
  </div>

  <div class="container">
    <div class="introduction">
      <h2>Understanding CPU Performance in the Browser</h2>
      <p>In this hands-on exercise, you'll learn how to:</p>
      <ul>
        <li>Record and analyze CPU performance</li>
        <li>Identify JavaScript execution patterns</li>
        <li>Detect long-running tasks that might block the main thread</li>
        <li>Understand the difference between efficient and inefficient code</li>
      </ul>
    </div>

    <div class="cwv-section">
      <h2>Core Web Vitals — Before You Record</h2>
      <ol>
        <li>Open DevTools (<kbd>F12</kbd>) → <strong>Performance</strong> tab.</li>
        <li>Enable <strong>"Core Web Vitals"</strong> in the settings (gear icon).</li>
        <li>Press <kbd>Ctrl+Shift+E</kbd> to reload-profile the page.</li>
        <li>Check the timeline for <strong>LCP</strong>, <strong>CLS</strong>, and <strong>INP</strong> markers.</li>
      </ol>

      <div class="cwv-demos">
        <div class="cwv-demo">
          <h3>INP Demo</h3>
          <p>Each click blocks the main thread longer, increasing <strong>INP</strong>. Check the <strong>Interactions</strong> lane.</p>
          <button id="inp-btn" onclick="heavyClick()" class="inp-btn">Click Me — Increase INP!</button>
          <div id="inp-counter" class="inp-counter">Clicks: 0 &nbsp;|&nbsp; Last blocking time: — ms</div>
        </div>

        <div class="cwv-demo">
          <h3>CLS Demo</h3>
          <p>This page intentionally injects several large blocks after load, causing <strong>multiple layout shifts</strong>. Look for them in the <strong>Experience</strong> lane.</p>
          <div id="cls-inject-area"></div>
          <p class="cls-victim">This text gets pushed down repeatedly — watch it jump!</p>
        </div>
      </div>
    </div>

    <div class="demo-section">
      <h2>Interactive Demos</h2>
      <div class="demo-controls">
        <div class="demo-group">
          <h3>Basic CPU Tasks</h3>
          <button onclick="simpleTask()" class="secondary-btn">Run Simple Task</button>
          <button onclick="cpuIntensiveTask()" class="primary-btn">Run CPU Intensive Task</button>
          <div class="inline-instructions">
            <p><strong>Task:</strong> Start recording, click <em>Simple Task</em> first, then click <em>CPU Intensive Task</em>, then stop recording. Compare both in the flamechart — find the bottleneck in the intensive task.</p>
          </div>
        </div>

        <div class="demo-group">
          <h3>Function Call Patterns</h3>
          <button id="atgo" onclick="go()" class="primary-btn">Run Sequential Tasks</button>
          <button onclick="runRecursive()" class="secondary-btn">Run Recursive Task</button>
          <div class="inline-instructions">
            <p><strong>Task:</strong> Record <em>Sequential Tasks</em> — spot functions a(), b(), c() in the flamechart. Then record <em>Recursive Task</em> — notice the deep call stack from Fibonacci. How do the flamechart shapes differ? Use the <strong>Bottom-Up</strong> and <strong>Call Tree</strong> views to see which functions use the most CPU.</p>
          </div>
        </div>

        <div class="demo-group">
          <h3>UI Blocking Demonstration</h3>
          <button onclick="animationTest()" class="primary-btn">Test Animation + CPU Load</button>
          <button onclick="asyncVsSync()" class="secondary-btn">Compare Async vs Sync</button>
          <div class="inline-instructions">
            <p><strong>Task:</strong> Record <em>Animation + CPU Load</em> — watch the FPS meter and notice dropped frames caused by JS blocking. Then record <em>Async vs Sync</em> — compare the continuous sync block vs the async gaps that keep the main thread responsive.</p>
            <p><strong>Tip:</strong> Enable <strong>CPU throttling</strong> (e.g. 4x, 6× or 20× slowdown) in the Performance panel toolbar to make the effects more visible on fast machines.</p>
          </div>
        </div>
      </div>

      <div id="animation-area" class="animation-container">
        <div id="moving-element" class="moving-element"></div>
      </div>

      <div id="result" class="result-display">Results will appear here</div>
    </div>

    <div class="instructions">
      <h2>How to Use the Performance Panel</h2>
      <ol>
        <li>Open DevTools by pressing <kbd>F12</kbd> or <kbd>Ctrl+Shift+I</kbd> (Windows/Linux) or
          <kbd>Cmd+Option+I</kbd> (Mac).
        </li>
        <li>Navigate to the <strong>Performance</strong> tab.</li>
        <li>Click the <strong>Record</strong> button (circle icon) to start profiling.</li>
        <li>Click any of the demo buttons above to perform an action.</li>
        <li>Click <strong>Stop</strong> to end the recording.</li>
        <li>Analyze the results using the guidance below.</li>
      </ol>

      <h2>Reading the Performance Panel</h2>
      <div class="panel-guide">
        <h3>Main Sections:</h3>
        <ul>
          <li><strong>Overview:</strong> Shows CPU activity, frames per second, and network requests over time.</li>
          <li><strong>Main Section:</strong> Displays flame chart of JavaScript execution, rendering, and painting.</li>
          <li><strong>Call Tree:</strong> Shows which functions consumed the most CPU time (Bottom-Up view).</li>
          <li><strong>Event Log:</strong> Chronological list of events that occurred during recording.</li>
        </ul>

        <h3>Key Patterns to Look For:</h3>
        <ul>
          <li><strong>Long yellow bars:</strong> JavaScript execution blocks that might cause jank.</li>
          <li><strong>Red frames:</strong> Frames that missed the 60fps target (potential user experience issues).</li>
          <li><strong>Deep call stacks:</strong> May indicate complex processing that could be optimized.</li>
          <li><strong>Repeated patterns:</strong> Opportunities for caching or memoization.</li>
        </ul>
      </div>

      <h2>Performance Optimization Tips</h2>
      <div class="tips">
        <ul>
          <li><strong>Use async/await or Promises</strong> for operations that can run in the background.</li>
          <li><strong>Break up long-running tasks</strong> using setTimeout or requestIdleCallback.</li>
          <li><strong>Move intensive work to Web Workers</strong> to avoid blocking the main thread.</li>
          <li><strong>Debounce or throttle</strong> event handlers that might fire frequently.</li>
          <li><strong>Memoize expensive calculations</strong> to avoid repeating them unnecessarily.</li>
          <li><strong>Use appropriate data structures</strong> for the operations you're performing.</li>
        </ul>
      </div>

      <h2>Additional Resources</h2>
      <ul>
        <li><a href="https://developer.chrome.com/docs/devtools/performance/" target="_blank">Browser DevTools
            Performance Documentation</a></li>
        <li><a href="https://web.dev/rail/" target="_blank">RAIL Performance Model</a></li>
        <li><a href="https://web.dev/optimize-javascript-execution/" target="_blank">Optimizing JavaScript Execution</a>
        </li>
      </ul>
    </div>
  </div>
</body>

</html>